import{r as p,c as S,o as $,a as E,w as D,b as n,d as e,e as N,g as x,p as g,h as i,j as k,F as h,v as F,t as r,i as w,n as I}from"./index-BNeUlDPJ.js";import{_ as B}from"./AdminLayout-CFtmi8Og.js";import{_ as j}from"./ComponentCard.vue_vue_type_script_setup_true_lang-BJgPpuPq.js";import{a as P}from"./axios-2s9xPmg-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const A={class:"space-y-5 sm:space-y-6"},R={class:"space-y-4"},H={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5"},Y=["value"],q={key:0,class:"grid grid-cols-2 gap-4 rounded-lg border border-stroke p-4 sm:grid-cols-5"},G={class:"text-center"},J={class:"text-2xl font-bold text-black"},K={class:"text-center"},O={class:"text-2xl font-bold text-danger"},Q={class:"text-center"},W={class:"text-2xl font-bold text-warning"},X={class:"text-center"},Z={class:"text-2xl font-bold text-secondary"},ee={class:"text-center"},te={class:"text-2xl font-bold text-black"},se={class:"overflow-x-auto"},ae={class:"w-full table-auto text-sm"},oe={class:"px-2 py-2 text-black text-xs"},re={class:"px-2 py-2"},le=["onClick"],ne={class:"px-2 py-2"},de={class:"px-2 py-2 text-black text-xs"},ie=["title"],ue={class:"px-2 py-2 text-black font-mono text-xs"},pe={key:0},ce={colspan:"5",class:"px-2 py-6 text-center text-bodydark"},xe={key:1,class:"flex items-center justify-between"},me={class:"text-sm text-bodydark"},ve={class:"flex gap-2"},ye=["disabled"],be=["onClick"],fe=["disabled"],Ce={__name:"FailureLogs",setup(_e){const y=p([]),b=p([]),d=p(null),m=p(0),l=p(1),o=p({proxyId:"",errorType:"",startDate:"",endDate:"",pageSize:50}),v=S(()=>Math.ceil(m.value/o.value.pageSize)),T=S(()=>{const a=[];let s=Math.max(1,l.value-Math.floor(2.5)),c=Math.min(v.value,s+5-1);c-s<4&&(s=Math.max(1,c-5+1));for(let _=s;_<=c;_++)a.push(_);return a}),V=a=>new Date(a).toLocaleString(),z=a=>a.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),M=a=>{const t=b.value.find(s=>s.id===a);return t?t.name||t.ip:a},L=a=>{o.value.proxyId=a,u(),C()},U=async()=>{try{const a=await P.get("/api/proxy");b.value=a.data.data||[]}catch(a){console.error("Failed to fetch proxies:",a)}},u=async()=>{try{const a={page:l.value,page_size:o.value.pageSize};o.value.proxyId&&(a.proxy_id=o.value.proxyId),o.value.errorType&&(a.error_type=o.value.errorType),o.value.startDate&&(a.start_date=o.value.startDate),o.value.endDate&&(a.end_date=o.value.endDate);const t=await P.get("/api/failureLogs",{params:a});y.value=t.data.data||[],m.value=t.data.total||0}catch(a){console.error("Failed to fetch failure logs:",a)}},C=async()=>{if(!o.value.proxyId){d.value=null;return}try{const a=await P.get(`/api/failureStats/${o.value.proxyId}`);d.value=a.data.data}catch(a){console.error("Failed to fetch stats:",a),d.value=null}},f=a=>{a<1||a>v.value||(l.value=a,u())};return $(async()=>{const t=new URLSearchParams(window.location.search).get("proxy_id");t&&(o.value.proxyId=t),await U(),await u(),o.value.proxyId&&await C()}),(a,t)=>(n(),E(B,null,{default:D(()=>[e("div",A,[N(j,{title:"Failure History"},{default:D(()=>[e("div",R,[e("div",H,[e("div",null,[t[8]||(t[8]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Proxy",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=s=>o.value.proxyId=s),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},[t[7]||(t[7]=e("option",{value:""},"All Proxies",-1)),(n(!0),i(h,null,k(b.value,s=>(n(),i("option",{key:s.id,value:s.id},r(s.name||s.ip),9,Y))),128))],544),[[g,o.value.proxyId]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Error Type",-1)),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>o.value.errorType=s),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},t[9]||(t[9]=[e("option",{value:""},"All Types",-1),e("option",{value:"ping_failed"},"Ping Failed",-1),e("option",{value:"speed_check_failed"},"Speed Check Failed",-1),e("option",{value:"ip_check_failed"},"IP Check Failed",-1)]),544),[[g,o.value.errorType]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Start Date",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=s=>o.value.startDate=s),onChange:u,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[F,o.value.startDate]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"End Date",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>o.value.endDate=s),onChange:u,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[F,o.value.endDate]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Page Size",-1)),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=s=>o.value.pageSize=s),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},t[13]||(t[13]=[e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[g,o.value.pageSize,void 0,{number:!0}]])])]),o.value.proxyId&&d.value?(n(),i("div",q,[e("div",G,[t[15]||(t[15]=e("p",{class:"text-sm text-bodydark"},"Total Failures",-1)),e("p",J,r(d.value.total_failures),1)]),e("div",K,[t[16]||(t[16]=e("p",{class:"text-sm text-bodydark"},"Ping Failures",-1)),e("p",O,r(d.value.ping_failures),1)]),e("div",Q,[t[17]||(t[17]=e("p",{class:"text-sm text-bodydark"},"Speed Failures",-1)),e("p",W,r(d.value.speed_failures),1)]),e("div",X,[t[18]||(t[18]=e("p",{class:"text-sm text-bodydark"},"IP Check Failures",-1)),e("p",Z,r(d.value.ip_check_failures),1)]),e("div",ee,[t[19]||(t[19]=e("p",{class:"text-sm text-bodydark"},"Failure Rate",-1)),e("p",te,r(d.value.failure_rate.toFixed(1))+"/day ",1)])])):w("",!0),e("div",se,[e("table",ae,[t[20]||(t[20]=e("thead",null,[e("tr",{class:"bg-gray-2 text-left"},[e("th",{class:"px-2 py-2 font-medium text-black text-nowrap"}," Timestamp "),e("th",{class:"px-2 py-2 font-medium text-black text-nowrap"}," Proxy "),e("th",{class:"px-2 py-2 font-medium text-black text-nowrap"}," Error Type "),e("th",{class:"px-2 py-2 font-medium text-black text-nowrap"}," Error Message "),e("th",{class:"px-2 py-2 font-medium text-black text-nowrap"}," Latency ")])],-1)),e("tbody",null,[(n(!0),i(h,null,k(y.value,s=>(n(),i("tr",{key:s.id,class:"border-b border-stroke hover:bg-gray-2"},[e("td",oe,r(V(s.timestamp)),1),e("td",re,[e("span",{onClick:c=>L(s.proxy_id),class:"cursor-pointer text-primary hover:underline text-xs"},r(M(s.proxy_id)),9,le)]),e("td",ne,[e("span",{class:I([{"bg-danger text-white":s.error_type==="ping_failed","bg-warning text-white":s.error_type==="speed_check_failed","bg-secondary text-white":s.error_type==="ip_check_failed"},"inline-flex rounded-full px-2 py-1 text-xs font-medium"])},r(z(s.error_type)),3)]),e("td",de,[e("span",{class:"max-w-md truncate block",title:s.error_msg},r(s.error_msg),9,ie)]),e("td",ue,r(s.latency)+"ms ",1)]))),128)),y.value.length===0?(n(),i("tr",pe,[e("td",ce," No failure logs found. "+r(o.value.proxyId||o.value.errorType||o.value.startDate?"Try adjusting your filters.":"Your proxies are working perfectly!"),1)])):w("",!0)])])]),v.value>1?(n(),i("div",xe,[e("p",me," Showing "+r((l.value-1)*o.value.pageSize+1)+" to "+r(Math.min(l.value*o.value.pageSize,m.value))+" of "+r(m.value)+" entries ",1),e("div",ve,[e("button",{onClick:t[5]||(t[5]=s=>f(l.value-1)),disabled:l.value===1,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Previous ",8,ye),(n(!0),i(h,null,k(T.value,s=>(n(),i("button",{key:s,onClick:c=>f(s),class:I([{"bg-primary text-white":s===l.value,"border-stroke hover:bg-gray":s!==l.value},"rounded-md border px-3 py-1"])},r(s),11,be))),128)),e("button",{onClick:t[6]||(t[6]=s=>f(l.value+1)),disabled:l.value===v.value,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Next ",8,fe)])])):w("",!0)])]),_:1})])]),_:1}))}};export{Ce as default};
