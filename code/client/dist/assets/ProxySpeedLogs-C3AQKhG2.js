import{r as c,c as M,o as A,a as H,w as V,b as n,d as a,e as R,g as f,p as z,h as d,j as w,F as D,v as I,t as r,i as F,n as b}from"./index-BNeUlDPJ.js";import{_ as q}from"./AdminLayout-CFtmi8Og.js";import{_ as G}from"./ComponentCard.vue_vue_type_script_setup_true_lang-BJgPpuPq.js";import{a as S}from"./axios-2s9xPmg-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const J={class:"space-y-5 sm:space-y-6"},K={class:"space-y-4"},O={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},Q=["value"],W={class:"overflow-x-auto"},X={class:"w-full table-auto"},Y={class:"px-4 py-3 text-black"},Z={class:"px-4 py-3"},ee=["onClick"],te={class:"px-4 py-3"},ae={class:"px-4 py-3"},se={class:"flex items-center gap-2"},oe={class:"px-4 py-3"},le={class:"flex items-center gap-2"},re={key:0},ne={colspan:"6",class:"px-4 py-8 text-center text-bodydark"},de={key:0,class:"flex items-center justify-between"},ie={class:"text-sm text-bodydark"},ue={class:"flex gap-2"},pe=["disabled"],ce=["onClick"],me=["disabled"],_e={__name:"ProxySpeedLogs",setup(xe){const g=c([]),_=c([]),x=c(null),v=c(0),l=c(1),o=c({proxyId:"",startDate:"",endDate:"",pageSize:50}),y=M(()=>Math.ceil(v.value/o.value.pageSize)),L=M(()=>{const s=[];let t=Math.max(1,l.value-Math.floor(2.5));const u=Math.min(y.value,t+5-1);u-t<4&&(t=Math.max(1,u-5+1));for(let m=t;m<=u;m++)s.push(m);return s}),U=s=>new Date(s).toLocaleString(),P=s=>{const e=s/1e3;return e>=50?"text-success":e>=25?"text-primary":e>=10?"text-warning":"text-danger"},N=s=>s?s<50?"text-success":s<100?"text-primary":s<200?"text-warning":"text-danger":"text-bodydark",$=s=>{const e=_.value.find(t=>t.id===s);return e?e.name||e.ip:s},B=s=>{o.value.proxyId=s,i(),C()},T=async()=>{try{const s=await S.get("/api/proxy");_.value=s.data.data||[]}catch(s){console.error("Failed to fetch proxies:",s)}},i=async()=>{try{const s={page:l.value,page_size:o.value.pageSize};o.value.proxyId&&(s.proxy_id=o.value.proxyId),o.value.startDate&&(s.start_date=o.value.startDate),o.value.endDate&&(s.end_date=o.value.endDate);const e=await S.get("/api/speedLogs",{params:s});g.value=e.data.data||[],v.value=e.data.total||0}catch(s){console.error("Failed to fetch speed logs:",s)}},C=async()=>{if(!o.value.proxyId){x.value=null;return}try{const s={proxy_id:o.value.proxyId,page_size:1e3};o.value.startDate&&(s.start_date=o.value.startDate),o.value.endDate&&(s.end_date=o.value.endDate);const t=(await S.get("/api/speedLogs",{params:s})).data.data||[];if(t.length>0){const u=t.reduce((p,h)=>p+h.speed,0)/t.length,m=t.reduce((p,h)=>p+h.upload,0)/t.length,j=Math.max(...t.map(p=>p.speed)),E=Math.max(...t.map(p=>p.upload));x.value={avg_download:(u/1e3).toFixed(2),avg_upload:(m/1e3).toFixed(2),max_download:(j/1e3).toFixed(2),max_upload:(E/1e3).toFixed(2)}}else x.value=null}catch(s){console.error("Failed to fetch stats:",s),x.value=null}},k=s=>{s<1||s>y.value||(l.value=s,i())};return A(async()=>{const e=new URLSearchParams(window.location.search).get("proxy_id");e&&(o.value.proxyId=e),await T(),await i(),o.value.proxyId&&await C()}),(s,e)=>(n(),H(q,null,{default:V(()=>[a("div",J,[R(G,{title:"Speed Test History"},{default:V(()=>[a("div",K,[a("div",O,[a("div",null,[e[7]||(e[7]=a("label",{class:"mb-2 block text-sm font-medium text-black"},"Proxy",-1)),f(a("select",{"onUpdate:modelValue":e[0]||(e[0]=t=>o.value.proxyId=t),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},[e[6]||(e[6]=a("option",{value:""},"All Proxies",-1)),(n(!0),d(D,null,w(_.value,t=>(n(),d("option",{key:t.id,value:t.id},r(t.name||t.ip),9,Q))),128))],544),[[z,o.value.proxyId]])]),a("div",null,[e[8]||(e[8]=a("label",{class:"mb-2 block text-sm font-medium text-black"},"Start Date",-1)),f(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.startDate=t),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[I,o.value.startDate]])]),a("div",null,[e[9]||(e[9]=a("label",{class:"mb-2 block text-sm font-medium text-black"},"End Date",-1)),f(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.endDate=t),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[I,o.value.endDate]])]),a("div",null,[e[11]||(e[11]=a("label",{class:"mb-2 block text-sm font-medium text-black"},"Page Size",-1)),f(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.pageSize=t),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},e[10]||(e[10]=[a("option",{value:25},"25",-1),a("option",{value:50},"50",-1),a("option",{value:100},"100",-1)]),544),[[z,o.value.pageSize,void 0,{number:!0}]])])]),a("div",W,[a("table",X,[e[14]||(e[14]=a("thead",null,[a("tr",{class:"bg-gray-2 text-left"},[a("th",{class:"px-4 py-3 font-medium text-black"},"Timestamp"),a("th",{class:"px-4 py-3 font-medium text-black"},"Proxy"),a("th",{class:"px-4 py-3 font-medium text-black"},"Ping"),a("th",{class:"px-4 py-3 font-medium text-black"}," Download Speed "),a("th",{class:"px-4 py-3 font-medium text-black"},"Upload Speed")])],-1)),a("tbody",null,[(n(!0),d(D,null,w(g.value,t=>(n(),d("tr",{key:t.id,class:"border-b border-stroke"},[a("td",Y,r(U(t.timestamp)),1),a("td",Z,[a("span",{onClick:u=>B(t.proxy_id),class:"cursor-pointer text-primary hover:underline"},r($(t.proxy_id)),9,ee)]),a("td",te,[a("span",{class:b([N(t.ping),"font-mono font-medium"])},r(t.ping?t.ping.toFixed(0):"-")+" ms ",3)]),a("td",ae,[a("div",se,[a("span",{class:b([P(t.speed),"font-mono font-medium"])},r(t.speed)+" Mbps ",3),e[12]||(e[12]=a("span",{class:"text-xs text-bodydark"},"↓",-1))])]),a("td",oe,[a("div",le,[a("span",{class:b([P(t.upload),"font-mono font-medium"])},r(t.upload)+" Mbps ",3),e[13]||(e[13]=a("span",{class:"text-xs text-bodydark"},"↑",-1))])])]))),128)),g.value.length===0?(n(),d("tr",re,[a("td",ne," No speed test logs found. "+r(o.value.proxyId||o.value.startDate?"Try adjusting your filters.":"No speed tests recorded yet."),1)])):F("",!0)])])]),y.value>1?(n(),d("div",de,[a("p",ie," Showing "+r((l.value-1)*o.value.pageSize+1)+" to "+r(Math.min(l.value*o.value.pageSize,v.value))+" of "+r(v.value)+" entries ",1),a("div",ue,[a("button",{onClick:e[4]||(e[4]=t=>k(l.value-1)),disabled:l.value===1,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Previous ",8,pe),(n(!0),d(D,null,w(L.value,t=>(n(),d("button",{key:t,onClick:u=>k(t),class:b([{"bg-primary text-white":t===l.value,"border-stroke hover:bg-gray":t!==l.value},"rounded-md border px-3 py-1"])},r(t),11,ce))),128)),a("button",{onClick:e[5]||(e[5]=t=>k(l.value+1)),disabled:l.value===y.value,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Next ",8,me)])])):F("",!0)])]),_:1})])]),_:1}))}};export{_e as default};
