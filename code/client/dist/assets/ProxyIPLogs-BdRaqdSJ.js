import{r as u,c as g,o as T,a as B,w as P,b as r,d as w,e as t,g as v,p as C,h as d,j as h,F as k,v as D,t as l,i as p,n as I}from"./index-Ba3DLgUF.js";import{a as U,_ as F}from"./AdminLayout-BUAEztLo.js";import{_ as j}from"./ComponentCard.vue_vue_type_script_setup_true_lang-B9VQ5Dgb.js";import{a as S}from"./axios-2s9xPmg-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const E={class:"space-y-5 sm:space-y-6"},A={class:"space-y-4"},H={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},R=["value"],q={class:"overflow-x-auto"},G={class:"w-full table-auto"},J={class:"px-4 py-3 text-black"},K={class:"px-4 py-3"},O=["onClick"],Q={class:"px-4 py-3"},W={class:"flex flex-col"},X={key:0,class:"text-xs text-bodydark line-through"},Y={class:"px-4 py-3"},Z={class:"flex flex-col"},ee={key:0,class:"text-xs text-bodydark line-through"},te={class:"text-sm text-black"},se={class:"px-4 py-3"},ae={class:"flex flex-col"},oe={key:0,class:"text-xs text-bodydark line-through"},le={class:"text-sm text-black"},re={key:0},ne={colspan:"6",class:"px-4 py-8 text-center text-bodydark"},de={key:0,class:"flex items-center justify-between"},ie={class:"text-sm text-bodydark"},ue={class:"flex gap-2"},ce=["disabled"],pe=["onClick"],xe=["disabled"],he={__name:"ProxyIPLogs",setup(me){const V=u("IP Change Logs"),y=u([]),b=u([]),x=u(0),n=u(1),o=u({proxyId:"",startDate:"",endDate:"",pageSize:50}),m=g(()=>Math.ceil(x.value/o.value.pageSize)),z=g(()=>{const a=[];let e=Math.max(1,n.value-Math.floor(2.5)),c=Math.min(m.value,e+5-1);c-e<4&&(e=Math.max(1,c-5+1));for(let _=e;_<=c;_++)a.push(_);return a}),M=a=>new Date(a).toLocaleString(),L=a=>{const s=b.value.find(e=>e.id===a);return s?s.name||s.ip:a},N=a=>{o.value.proxyId=a,i()},$=async()=>{try{const a=await S.get("/api/proxy");b.value=a.data.data||[]}catch(a){console.error("Failed to fetch proxies:",a)}},i=async()=>{try{const a={page:n.value,page_size:o.value.pageSize};o.value.proxyId&&(a.proxy_id=o.value.proxyId),o.value.startDate&&(a.start_date=o.value.startDate),o.value.endDate&&(a.end_date=o.value.endDate);const s=await S.get("/api/ipLogs",{params:a});y.value=s.data.data||[],x.value=s.data.total||0}catch(a){console.error("Failed to fetch IP logs:",a)}},f=a=>{a<1||a>m.value||(n.value=a,i())};return T(async()=>{const s=new URLSearchParams(window.location.search).get("proxy_id");s&&(o.value.proxyId=s),await $(),await i()}),(a,s)=>(r(),B(U,null,{default:P(()=>[w(F,{pageTitle:V.value},null,8,["pageTitle"]),t("div",E,[w(j,{title:"IP Change History"},{default:P(()=>[t("div",A,[t("div",H,[t("div",null,[s[7]||(s[7]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Proxy",-1)),v(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>o.value.proxyId=e),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},[s[6]||(s[6]=t("option",{value:""},"All Proxies",-1)),(r(!0),d(k,null,h(b.value,e=>(r(),d("option",{key:e.id,value:e.id},l(e.name||e.ip),9,R))),128))],544),[[C,o.value.proxyId]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Start Date",-1)),v(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>o.value.startDate=e),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[D,o.value.startDate]])]),t("div",null,[s[9]||(s[9]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"End Date",-1)),v(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>o.value.endDate=e),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[D,o.value.endDate]])]),t("div",null,[s[11]||(s[11]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Page Size",-1)),v(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>o.value.pageSize=e),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},s[10]||(s[10]=[t("option",{value:25},"25",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1)]),544),[[C,o.value.pageSize,void 0,{number:!0}]])])]),t("div",q,[t("table",G,[s[12]||(s[12]=t("thead",null,[t("tr",{class:"bg-gray-2 text-left"},[t("th",{class:"px-4 py-3 font-medium text-black"},"Timestamp"),t("th",{class:"px-4 py-3 font-medium text-black"},"Proxy"),t("th",{class:"px-4 py-3 font-medium text-black"},"IP Change"),t("th",{class:"px-4 py-3 font-medium text-black"}," Country Change "),t("th",{class:"px-4 py-3 font-medium text-black"},"ISP Change")])],-1)),t("tbody",null,[(r(!0),d(k,null,h(y.value,e=>(r(),d("tr",{key:e.id,class:"border-b border-stroke"},[t("td",J,l(M(e.timestamp)),1),t("td",K,[t("span",{onClick:c=>N(e.proxy_id),class:"cursor-pointer text-primary hover:underline"},l(L(e.proxy_id)),9,O)]),t("td",Q,[t("div",W,[e.old_ip?(r(),d("span",X,l(e.old_ip),1)):p("",!0),t("span",{class:I(["font-mono text-sm",e.stack?"text-red-500 font-semibold":"text-black"])},l(e.ip),3)])]),t("td",Y,[t("div",Z,[e.old_country&&e.old_country!=e.country?(r(),d("span",ee,l(e.old_country),1)):p("",!0),t("span",te,l(e.country),1)])]),t("td",se,[t("div",ae,[e.old_isp&&e.old_isp!=e.isp?(r(),d("span",oe,l(e.old_isp),1)):p("",!0),t("span",le,l(e.isp),1)])])]))),128)),y.value.length===0?(r(),d("tr",re,[t("td",ne," No IP change logs found. "+l(o.value.proxyId||o.value.startDate?"Try adjusting your filters.":"No IP changes recorded yet."),1)])):p("",!0)])])]),m.value>1?(r(),d("div",de,[t("p",ie," Showing "+l((n.value-1)*o.value.pageSize+1)+" to "+l(Math.min(n.value*o.value.pageSize,x.value))+" of "+l(x.value)+" entries ",1),t("div",ue,[t("button",{onClick:s[4]||(s[4]=e=>f(n.value-1)),disabled:n.value===1,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Previous ",8,ce),(r(!0),d(k,null,h(z.value,e=>(r(),d("button",{key:e,onClick:c=>f(e),class:I([{"bg-primary text-white":e===n.value,"border-stroke hover:bg-gray":e!==n.value},"rounded-md border px-3 py-1"])},l(e),11,pe))),128)),t("button",{onClick:s[5]||(s[5]=e=>f(n.value+1)),disabled:n.value===m.value,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Next ",8,xe)])])):p("",!0)])]),_:1})])]),_:1}))}};export{he as default};
