import{r as p,c as S,o as N,a as B,w as D,b as n,d as F,e,g as x,p as g,h as d,j as k,F as h,v as T,t as l,i as w,n as I}from"./index-Ba3DLgUF.js";import{a as j,_ as A}from"./AdminLayout-BUAEztLo.js";import{_ as R}from"./ComponentCard.vue_vue_type_script_setup_true_lang-B9VQ5Dgb.js";import{a as P}from"./axios-2s9xPmg-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const H={class:"space-y-5 sm:space-y-6"},Y={class:"space-y-4"},q={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-5"},G=["value"],J={key:0,class:"grid grid-cols-2 gap-4 rounded-lg border border-stroke p-4 sm:grid-cols-5"},K={class:"text-center"},O={class:"text-2xl font-bold text-black"},Q={class:"text-center"},W={class:"text-2xl font-bold text-danger"},X={class:"text-center"},Z={class:"text-2xl font-bold text-warning"},ee={class:"text-center"},te={class:"text-2xl font-bold text-secondary"},ae={class:"text-center"},se={class:"text-2xl font-bold text-black"},oe={class:"overflow-x-auto"},le={class:"w-full table-auto"},re={class:"px-4 py-3 text-black"},ne={class:"px-4 py-3"},ie=["onClick"],de={class:"px-4 py-3"},ue={class:"px-4 py-3 text-black"},pe=["title"],ce={class:"px-4 py-3 text-black"},xe={key:0},me={colspan:"5",class:"px-4 py-8 text-center text-bodydark"},ve={key:1,class:"flex items-center justify-between"},ye={class:"text-sm text-bodydark"},be={class:"flex gap-2"},fe=["disabled"],_e=["onClick"],ge=["disabled"],De={__name:"FailureLogs",setup(ke){const V=p("Failure Logs"),y=p([]),b=p([]),i=p(null),m=p(0),r=p(1),o=p({proxyId:"",errorType:"",startDate:"",endDate:"",pageSize:50}),v=S(()=>Math.ceil(m.value/o.value.pageSize)),z=S(()=>{const s=[];let a=Math.max(1,r.value-Math.floor(2.5)),c=Math.min(v.value,a+5-1);c-a<4&&(a=Math.max(1,c-5+1));for(let _=a;_<=c;_++)s.push(_);return s}),M=s=>new Date(s).toLocaleString(),L=s=>s.split("_").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),$=s=>{const t=b.value.find(a=>a.id===s);return t?t.name||t.ip:s},U=s=>{o.value.proxyId=s,u(),C()},E=async()=>{try{const s=await P.get("/api/proxy");b.value=s.data.data||[]}catch(s){console.error("Failed to fetch proxies:",s)}},u=async()=>{try{const s={page:r.value,page_size:o.value.pageSize};o.value.proxyId&&(s.proxy_id=o.value.proxyId),o.value.errorType&&(s.error_type=o.value.errorType),o.value.startDate&&(s.start_date=o.value.startDate),o.value.endDate&&(s.end_date=o.value.endDate);const t=await P.get("/api/failureLogs",{params:s});y.value=t.data.data||[],m.value=t.data.total||0}catch(s){console.error("Failed to fetch failure logs:",s)}},C=async()=>{if(!o.value.proxyId){i.value=null;return}try{const s=await P.get(`/api/failureStats/${o.value.proxyId}`);i.value=s.data.data}catch(s){console.error("Failed to fetch stats:",s),i.value=null}},f=s=>{s<1||s>v.value||(r.value=s,u())};return N(async()=>{const t=new URLSearchParams(window.location.search).get("proxy_id");t&&(o.value.proxyId=t),await E(),await u(),o.value.proxyId&&await C()}),(s,t)=>(n(),B(j,null,{default:D(()=>[F(A,{pageTitle:V.value},null,8,["pageTitle"]),e("div",H,[F(R,{title:"Failure History"},{default:D(()=>[e("div",Y,[e("div",q,[e("div",null,[t[8]||(t[8]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Proxy",-1)),x(e("select",{"onUpdate:modelValue":t[0]||(t[0]=a=>o.value.proxyId=a),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},[t[7]||(t[7]=e("option",{value:""},"All Proxies",-1)),(n(!0),d(h,null,k(b.value,a=>(n(),d("option",{key:a.id,value:a.id},l(a.name||a.ip),9,G))),128))],544),[[g,o.value.proxyId]])]),e("div",null,[t[10]||(t[10]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Error Type",-1)),x(e("select",{"onUpdate:modelValue":t[1]||(t[1]=a=>o.value.errorType=a),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},t[9]||(t[9]=[e("option",{value:""},"All Types",-1),e("option",{value:"ping_failed"},"Ping Failed",-1),e("option",{value:"speed_check_failed"},"Speed Check Failed",-1),e("option",{value:"ip_check_failed"},"IP Check Failed",-1)]),544),[[g,o.value.errorType]])]),e("div",null,[t[11]||(t[11]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Start Date",-1)),x(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>o.value.startDate=a),onChange:u,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[T,o.value.startDate]])]),e("div",null,[t[12]||(t[12]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"End Date",-1)),x(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>o.value.endDate=a),onChange:u,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[T,o.value.endDate]])]),e("div",null,[t[14]||(t[14]=e("label",{class:"mb-2 block text-sm font-medium text-black"},"Page Size",-1)),x(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>o.value.pageSize=a),onChange:u,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},t[13]||(t[13]=[e("option",{value:25},"25",-1),e("option",{value:50},"50",-1),e("option",{value:100},"100",-1)]),544),[[g,o.value.pageSize,void 0,{number:!0}]])])]),o.value.proxyId&&i.value?(n(),d("div",J,[e("div",K,[t[15]||(t[15]=e("p",{class:"text-sm text-bodydark"},"Total Failures",-1)),e("p",O,l(i.value.total_failures),1)]),e("div",Q,[t[16]||(t[16]=e("p",{class:"text-sm text-bodydark"},"Ping Failures",-1)),e("p",W,l(i.value.ping_failures),1)]),e("div",X,[t[17]||(t[17]=e("p",{class:"text-sm text-bodydark"},"Speed Failures",-1)),e("p",Z,l(i.value.speed_failures),1)]),e("div",ee,[t[18]||(t[18]=e("p",{class:"text-sm text-bodydark"},"IP Check Failures",-1)),e("p",te,l(i.value.ip_check_failures),1)]),e("div",ae,[t[19]||(t[19]=e("p",{class:"text-sm text-bodydark"},"Failure Rate",-1)),e("p",se,l(i.value.failure_rate.toFixed(1))+"/day ",1)])])):w("",!0),e("div",oe,[e("table",le,[t[20]||(t[20]=e("thead",null,[e("tr",{class:"bg-gray-2 text-left"},[e("th",{class:"px-4 py-3 font-medium text-black"}," Timestamp "),e("th",{class:"px-4 py-3 font-medium text-black"}," Proxy "),e("th",{class:"px-4 py-3 font-medium text-black"}," Error Type "),e("th",{class:"px-4 py-3 font-medium text-black"}," Error Message "),e("th",{class:"px-4 py-3 font-medium text-black"}," Latency ")])],-1)),e("tbody",null,[(n(!0),d(h,null,k(y.value,a=>(n(),d("tr",{key:a.id,class:"border-b border-stroke"},[e("td",re,l(M(a.timestamp)),1),e("td",ne,[e("span",{onClick:c=>U(a.proxy_id),class:"cursor-pointer text-primary hover:underline"},l($(a.proxy_id)),9,ie)]),e("td",de,[e("span",{class:I([{"bg-danger text-white":a.error_type==="ping_failed","bg-warning text-white":a.error_type==="speed_check_failed","bg-secondary text-white":a.error_type==="ip_check_failed"},"inline-flex rounded-full px-3 py-1 text-xs font-medium"])},l(L(a.error_type)),3)]),e("td",ue,[e("span",{class:"max-w-md truncate",title:a.error_msg},l(a.error_msg),9,pe)]),e("td",ce,l(a.latency)+"ms ",1)]))),128)),y.value.length===0?(n(),d("tr",xe,[e("td",me," No failure logs found. "+l(o.value.proxyId||o.value.errorType||o.value.startDate?"Try adjusting your filters.":"Your proxies are working perfectly!"),1)])):w("",!0)])])]),v.value>1?(n(),d("div",ve,[e("p",ye," Showing "+l((r.value-1)*o.value.pageSize+1)+" to "+l(Math.min(r.value*o.value.pageSize,m.value))+" of "+l(m.value)+" entries ",1),e("div",be,[e("button",{onClick:t[5]||(t[5]=a=>f(r.value-1)),disabled:r.value===1,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Previous ",8,fe),(n(!0),d(h,null,k(z.value,a=>(n(),d("button",{key:a,onClick:c=>f(a),class:I([{"bg-primary text-white":a===r.value,"border-stroke hover:bg-gray":a!==r.value},"rounded-md border px-3 py-1"])},l(a),11,_e))),128)),e("button",{onClick:t[6]||(t[6]=a=>f(r.value+1)),disabled:r.value===v.value,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Next ",8,ge)])])):w("",!0)])]),_:1})])]),_:1}))}};export{De as default};
