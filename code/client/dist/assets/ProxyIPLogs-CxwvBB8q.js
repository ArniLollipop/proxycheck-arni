import{r as c,c as g,o as L,a as $,w as P,b as r,d as t,e as B,g as y,p as w,h as d,j as h,F as k,v as C,t as l,i as p,n as D}from"./index-BNeUlDPJ.js";import{_ as U}from"./AdminLayout-CFtmi8Og.js";import{_ as F}from"./ComponentCard.vue_vue_type_script_setup_true_lang-BJgPpuPq.js";import{a as I}from"./axios-2s9xPmg-.js";import"./_plugin-vue_export-helper-DlAUqK2U.js";const j={class:"space-y-5 sm:space-y-6"},T={class:"space-y-4"},E={class:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4"},A=["value"],H={class:"overflow-x-auto"},R={class:"w-full table-auto"},q={class:"px-4 py-3 text-black"},G={class:"px-4 py-3"},J=["onClick"],K={class:"px-4 py-3"},O={class:"flex flex-col"},Q={key:0,class:"text-xs text-bodydark line-through"},W={class:"px-4 py-3"},X={class:"flex flex-col"},Y={key:0,class:"text-xs text-bodydark line-through"},Z={class:"text-sm text-black"},ee={class:"px-4 py-3"},te={class:"flex flex-col"},se={key:0,class:"text-xs text-bodydark line-through"},oe={class:"text-sm text-black"},ae={key:0},le={colspan:"6",class:"px-4 py-8 text-center text-bodydark"},re={key:0,class:"flex items-center justify-between"},ne={class:"text-sm text-bodydark"},de={class:"flex gap-2"},ie=["disabled"],ue=["onClick"],ce=["disabled"],fe={__name:"ProxyIPLogs",setup(pe){const v=c([]),b=c([]),x=c(0),n=c(1),a=c({proxyId:"",startDate:"",endDate:"",pageSize:50}),m=g(()=>Math.ceil(x.value/a.value.pageSize)),S=g(()=>{const o=[];let e=Math.max(1,n.value-Math.floor(2.5)),u=Math.min(m.value,e+5-1);u-e<4&&(e=Math.max(1,u-5+1));for(let _=e;_<=u;_++)o.push(_);return o}),V=o=>new Date(o).toLocaleString(),z=o=>{const s=b.value.find(e=>e.id===o);return s?s.name||s.ip:o},M=o=>{a.value.proxyId=o,i()},N=async()=>{try{const o=await I.get("/api/proxy");b.value=o.data.data||[]}catch(o){console.error("Failed to fetch proxies:",o)}},i=async()=>{try{const o={page:n.value,page_size:a.value.pageSize};a.value.proxyId&&(o.proxy_id=a.value.proxyId),a.value.startDate&&(o.start_date=a.value.startDate),a.value.endDate&&(o.end_date=a.value.endDate);const s=await I.get("/api/ipLogs",{params:o});v.value=s.data.data||[],x.value=s.data.total||0}catch(o){console.error("Failed to fetch IP logs:",o)}},f=o=>{o<1||o>m.value||(n.value=o,i())};return L(async()=>{const s=new URLSearchParams(window.location.search).get("proxy_id");s&&(a.value.proxyId=s),await N(),await i()}),(o,s)=>(r(),$(U,null,{default:P(()=>[t("div",j,[B(F,{title:"IP Change History"},{default:P(()=>[t("div",T,[t("div",E,[t("div",null,[s[7]||(s[7]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Proxy",-1)),y(t("select",{"onUpdate:modelValue":s[0]||(s[0]=e=>a.value.proxyId=e),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},[s[6]||(s[6]=t("option",{value:""},"All Proxies",-1)),(r(!0),d(k,null,h(b.value,e=>(r(),d("option",{key:e.id,value:e.id},l(e.name||e.ip),9,A))),128))],544),[[w,a.value.proxyId]])]),t("div",null,[s[8]||(s[8]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Start Date",-1)),y(t("input",{"onUpdate:modelValue":s[1]||(s[1]=e=>a.value.startDate=e),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[C,a.value.startDate]])]),t("div",null,[s[9]||(s[9]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"End Date",-1)),y(t("input",{"onUpdate:modelValue":s[2]||(s[2]=e=>a.value.endDate=e),onChange:i,type:"date",class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},null,544),[[C,a.value.endDate]])]),t("div",null,[s[11]||(s[11]=t("label",{class:"mb-2 block text-sm font-medium text-black"},"Page Size",-1)),y(t("select",{"onUpdate:modelValue":s[3]||(s[3]=e=>a.value.pageSize=e),onChange:i,class:"w-full rounded-md border border-stroke px-4 py-2 focus:border-primary focus:outline-none"},s[10]||(s[10]=[t("option",{value:25},"25",-1),t("option",{value:50},"50",-1),t("option",{value:100},"100",-1)]),544),[[w,a.value.pageSize,void 0,{number:!0}]])])]),t("div",H,[t("table",R,[s[12]||(s[12]=t("thead",null,[t("tr",{class:"bg-gray-2 text-left"},[t("th",{class:"px-4 py-3 font-medium text-black"},"Timestamp"),t("th",{class:"px-4 py-3 font-medium text-black"},"Proxy"),t("th",{class:"px-4 py-3 font-medium text-black"},"IP Change"),t("th",{class:"px-4 py-3 font-medium text-black"}," Country Change "),t("th",{class:"px-4 py-3 font-medium text-black"},"ISP Change")])],-1)),t("tbody",null,[(r(!0),d(k,null,h(v.value,e=>(r(),d("tr",{key:e.id,class:"border-b border-stroke"},[t("td",q,l(V(e.timestamp)),1),t("td",G,[t("span",{onClick:u=>M(e.proxy_id),class:"cursor-pointer text-primary hover:underline"},l(z(e.proxy_id)),9,J)]),t("td",K,[t("div",O,[e.old_ip?(r(),d("span",Q,l(e.old_ip),1)):p("",!0),t("span",{class:D(["font-mono text-sm",e.stack?"text-red-500 font-semibold":"text-black"])},l(e.ip),3)])]),t("td",W,[t("div",X,[e.old_country&&e.old_country!=e.country?(r(),d("span",Y,l(e.old_country),1)):p("",!0),t("span",Z,l(e.country),1)])]),t("td",ee,[t("div",te,[e.old_isp&&e.old_isp!=e.isp?(r(),d("span",se,l(e.old_isp),1)):p("",!0),t("span",oe,l(e.isp),1)])])]))),128)),v.value.length===0?(r(),d("tr",ae,[t("td",le," No IP change logs found. "+l(a.value.proxyId||a.value.startDate?"Try adjusting your filters.":"No IP changes recorded yet."),1)])):p("",!0)])])]),m.value>1?(r(),d("div",re,[t("p",ne," Showing "+l((n.value-1)*a.value.pageSize+1)+" to "+l(Math.min(n.value*a.value.pageSize,x.value))+" of "+l(x.value)+" entries ",1),t("div",de,[t("button",{onClick:s[4]||(s[4]=e=>f(n.value-1)),disabled:n.value===1,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Previous ",8,ie),(r(!0),d(k,null,h(S.value,e=>(r(),d("button",{key:e,onClick:u=>f(e),class:D([{"bg-primary text-white":e===n.value,"border-stroke hover:bg-gray":e!==n.value},"rounded-md border px-3 py-1"])},l(e),11,ue))),128)),t("button",{onClick:s[5]||(s[5]=e=>f(n.value+1)),disabled:n.value===m.value,class:"rounded-md border border-stroke px-3 py-1 hover:bg-gray disabled:opacity-50"}," Next ",8,ce)])])):p("",!0)])]),_:1})])]),_:1}))}};export{fe as default};
